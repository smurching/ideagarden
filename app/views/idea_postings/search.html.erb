<div id = "start_of_results">
	
<h1 id="index_heading">Idea Postings</h1>
	
<%= render "form" %>
<br/>

<%= div_for(@idea_postings) do |idea_posting| %>
  <div class = 'voting'>
  	<div class = 'voting_button'>
    <% if logged_in? %>
      <% if current_user.posting_votes.include? idea_posting.id %>
        <%= button_to '+', unvote_path(idea_posting.id), :class => "vote_button unvote_button", :remote => true %>
      <% else %>
        <%= button_to '+', upvote_path(idea_posting.id), :class => "vote_button upvote_button", :remote => true %>
      <% end %>
    <% else %>
      <%= button_to '+', upvote_path(idea_posting.id), :class => "vote_button upvote_button", :remote => true %>
    <% end %>
    </div>
    <div class = 'potential'>
      <%= idea_posting.potential %>
    </div>
  </div>
  <div class = 'posting'>
    <div class = 'thumbnail'></div>
    <div class = 'brief'>
      <h2 class = 'title'><%= link_to idea_posting.name, idea_posting %></h2>
      <p class = 'owners'>by <% idea_posting.users.each do |user| %><%= link_to user.profile.name + ", ", user_profiles_path(user.id) %><% end %></p>
      <h3 class = 'pitch'>Pitch: <%= simple_format(idea_posting.pitch) %></h3>
      <h3 class = "tags">Tags: 
		<% if idea_posting.tags.length >= 2%>
      	<% (0..idea_posting.tags.length-2).each do |int| %>
    	<%= idea_posting.tags[int].value+", " %>
    	<% end %>
    	<%= idea_posting.tags.last.value%>  
    	<%else%>
    	<% idea_posting.tags.each do |tag| %>
    	<%= tag.value%>
    	<%end%>
    	<%end%>
      </h3>
    </div>
  </div>
<% end %>

</div>



<script>
 $(function(){	
	
	$.watermark.options.className = 'watermark'; 	
	$.watermark.options.useNative = false;
 	$('#idea_posting_name').watermark("Got an Idea?", {className: "centered_watermark"});
 	$('#idea_posting_pitch').watermark("Pitch (10 char. minimum)", {className: "centered_watermark"});
 	$('#idea_posting_description').watermark("Description (10 char. minimum)", {className: "centered_watermark"});
 	
 	// when the idea posting form is clicked, change its watermark from "Got an idea?" to "Title (10 char. minimum)"
 	$('#idea_posting_name').on("click", function(){
 		$(this).watermark("Title (10 char. minimum)");
 	});
 	
 });
 
 
 $(function(){
 	// hides up-pointing caret arrow to start with
 	$('#caret_up').hide();
 	
 	// hides form except for "Got an idea?" input element
 	$('#new_idea_posting').find('div').hide();
 	$('#name_div').show();
 	


 	$('#idea_posting_name').on("click", function(){
 		
 			// when first input is clicked, show the rest of the form
			$('#new_idea_posting').find('div').show();
			
 			// hide the downwards-pointing caret and show the up-pointing one			
			$('#caret_down').hide();
			$('#caret_up').show(); 		
			
 	});
 	
 	// offset the caret to an appropriate position. 
 	// for some reason the "got an idea?" tag also needs to be offset -17px 
 	var o = $('#name_div').offset();
 	$('#caret_up, #caret_down').css({"top" :$('#idea_posting_name').outerHeight()/2-5-$('.form_caret').outerHeight()/2, "left" : $('#idea_posting_name').width()});
 	$('#name_div').css({"margin-left": "-17px"});
 	
 	
 	$('.form_caret').on("click", function(){
 		if($(this).attr("src")=="/assets/caret_down.png"){
 			
 			// if the down caret was clicked, hide it and show the up caret
			$('#caret_down').hide();
			$('#caret_up').show(); 	
			
			// show rest of idea posting form		
			$('#new_idea_posting').find('div').show();	
			
 		}
 		else{
 			
 			// if the up caret was clicked, hide it and show the down caret
			$('#caret_up').hide(); 			
			$('#caret_down').show();
			
			// hide the rest of the idea posting form and reset the watermark to "Got an idea?"					
			$('#new_idea_posting').find('div').hide();
 			$('#idea_posting_name').watermark("Got an Idea?");			
 			$('#name_div').show();
	
 		}
 		
 	});
 	
 });
 
 
 
 $(function(){
 	var now = jQuery.now();
 	$('#new_idea_posting').find('li').on("click", function(){
 		if(jQuery.now()-now>100){
 			// var changed = 0;
 			if($(this).attr("class") == "inactive"){
 				$(this).attr("class", "active");
 				// changed+=1;
 			}
 			else{
 				$(this).attr("class", "inactive");
 				// changed+=1;
 			}
 			// $('#wrapper').prepend("<p>"+changed.toString()+"</p>");
 		}
 		now = jQuery.now(); 	 
 		var params = "?"
 		$('#new_idea_posting').find("li").each(function(){
 			params += $(this).attr("id")+"=true&";
 		});
 	
 		$('#new_idea_posting').attr("action", "/idea_postings"+params); 				
 		});

 	
 });
 	
</script>

<div id = "end_of_results"></div>



